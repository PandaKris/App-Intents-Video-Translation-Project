1
00:00:00,600 --> 00:00:02,802
Hello! In the previous module, we learned

2
00:00:02,869 --> 00:00:05,105
how to add a parameter to an app intent

3
00:00:05,171 --> 00:00:06,539
to make it customizable.

4
00:00:07,273 --> 00:00:09,409
We also saw how to use this parameter

5
00:00:09,476 --> 00:00:12,412
with shortcuts, Siri, and widgets.

6
00:00:13,079 --> 00:00:15,682
So far, we have used just primitive types

7
00:00:15,749 --> 00:00:18,418
as parameters, which limits control

8
00:00:18,485 --> 00:00:20,320
and makes natural language interactions,

9
00:00:20,820 --> 00:00:22,022
like full sentence Siri requests,

10
00:00:22,088 --> 00:00:23,523
less effective.

11
00:00:26,007 --> 00:00:28,395
Hi, my name is Sergio and we will see how

12
00:00:28,461 --> 00:00:29,529
to overcome these

13
00:00:29,596 --> 00:00:31,898
limitations using App entities.

14
00:00:34,033 --> 00:00:36,703
An App entity is a concept that your app

15
00:00:36,770 --> 00:00:38,905
exposed to the App Intent system.

16
00:00:39,639 --> 00:00:41,808
It's a powerful abstraction that allows

17
00:00:41,875 --> 00:00:44,811
custom, dynamic data to be used in

18
00:00:44,878 --> 00:00:46,312
shortcuts and widgets.

19
00:00:47,947 --> 00:00:51,217
Let's take a new item as an example of

20
00:00:51,284 --> 00:00:52,886
an entity our app can expose.

21
00:00:53,620 --> 00:00:57,357
Here's our MenuItemEntity.switt

22
00:00:58,258 --> 00:01:00,827
To be used as an entity, the type must

23
00:01:00,894 --> 00:01:03,329
conform to the AppEntity protocol.

24
00:01:04,330 --> 00:01:05,932
Let's highlight the key elements.

25
00:01:07,000 --> 00:01:08,468
The ID is a unique

26
00:01:08,535 --> 00:01:10,403
identifier for the entity.

27
00:01:12,205 --> 00:01:14,541
The property of our name makes name

28
00:01:14,607 --> 00:01:17,076
available for App Intent to be used

29
00:01:17,143 --> 00:01:18,211
directly in phrases.

30
00:01:19,579 --> 00:01:21,981
The display representation controls how

31
00:01:22,048 --> 00:01:23,683
the entity appears to the users.

32
00:01:24,484 --> 00:01:26,085
Here we use only the name.

33
00:01:27,620 --> 00:01:30,457
The typeDisplayRepresentation is

34
00:01:30,523 --> 00:01:32,292
a user facing string that

35
00:01:32,358 --> 00:01:33,993
describes the kind of entity.

36
00:01:34,727 --> 00:01:36,796
We define it as product.

37
00:01:37,997 --> 00:01:40,500
And finally, the initializer let us

38
00:01:40,567 --> 00:01:43,937
easily convert from a MenuItem model

39
00:01:44,003 --> 00:01:45,772
to our MenuItemEntity structure.

40
00:01:47,006 --> 00:01:49,375
But we're still missing the lookup

41
00:01:49,442 --> 00:01:51,344
mechanism, the defaultQuery.

42
00:01:52,545 --> 00:01:54,514
Let's implement the menu item query,

43
00:01:54,881 --> 00:01:56,483
which is responsible for

44
00:01:56,549 --> 00:01:58,718
searching and suggesting items.

45
00:01:59,619 --> 00:02:01,855
This structure conforms to the entity

46
00:02:01,921 --> 00:02:03,423
string query protocol.

47
00:02:04,123 --> 00:02:05,758
Let's break it down.

48
00:02:06,726 --> 00:02:07,927
Entities for

49
00:02:08,795 --> 00:02:10,697
Retrieves entities by their IDs,

50
00:02:10,763 --> 00:02:13,900
required by all queries.

51
00:02:16,002 --> 00:02:18,138
Entities matching allows

52
00:02:18,204 --> 00:02:20,140
searching by a text string.

53
00:02:20,673 --> 00:02:22,642
In our case, we search the

54
00:02:22,709 --> 00:02:24,677
product name in our model.

55
00:02:26,312 --> 00:02:28,681
Suggested entities returns a default list,

56
00:02:28,748 --> 00:02:31,851
such as favorites are top sellers,

57
00:02:32,318 --> 00:02:35,221
that shows up as autocomplete suggestions.

58
00:02:36,156 --> 00:02:38,024
And now, let's use this

59
00:02:38,091 --> 00:02:40,560
entity in an actual intent.

60
00:02:43,763 --> 00:02:45,899
The key change here is using the

61
00:02:45,965 --> 00:02:48,768
MenuItemEntity instead of a raw string

62
00:02:48,835 --> 00:02:51,337
in the parameter attribute.

63
00:02:52,505 --> 00:02:55,575
Then, in the perform function,

64
00:02:55,642 --> 00:02:58,344
we use this entity to fetch the actual model

65
00:02:58,411 --> 00:03:00,013
data from our system.

66
00:03:00,947 --> 00:03:03,016
Now, to make the suggestions work

67
00:03:03,082 --> 00:03:05,885
dynamically, we must notify the system

68
00:03:05,952 --> 00:03:07,053
whenever they change.

69
00:03:09,389 --> 00:03:12,559
Let's do this in the app setup using

70
00:03:12,625 --> 00:03:15,428
the update app shortcuts parameters function.

71
00:03:18,598 --> 00:03:19,566
And that's it!

72
00:03:20,200 --> 00:03:22,635
Now, we have a fully working Intent that

73
00:03:22,702 --> 00:03:25,572
uses a real entity from our app model,

74
00:03:25,972 --> 00:03:28,675
enabling better Siri integration,

75
00:03:28,741 --> 00:03:30,243
widget suggestions, and more

76
00:03:30,310 --> 00:03:32,178
natural shortcut interactions.

77
00:03:32,679 --> 00:03:34,647
In the next video, we'll explore how

78
00:03:34,714 --> 00:03:36,583
to create and use these shortcuts,

79
00:03:36,916 --> 00:03:38,685
both manually and programmatically.

80
00:03:39,118 --> 00:03:39,652
See you there!

